<!-- gym/templates/home.html -->

{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="content">
    <h1>Welcome to the Home Page!</h1>
    <p>This is the home page of the website. You can log in or sign up using the navigation bar.</p>

    {% if user.user_type == 'gym_owner' %}
        <h2>Your Gyms</h2>
        <div id="gym-list" class="mb-3"></div>

        <h3>Add New Gym</h3>
        <form id="add-gym-form" class="mb-3">
            {% csrf_token %}
            <div class="form-group">
                <label for="gym_name">Gym Name:</label>
                <input type="text" class="form-control" id="gym_name" name="gym_name" required>
            </div>

            <div class="form-group">
                <label for="description">Description:</label>
                <textarea class="form-control" id="description" name="description" required></textarea>
            </div>

            <div class="form-group">
                <label for="city">City:</label>
                <input type="text" class="form-control" id="city" name="city" required>
            </div>

            <button type="submit" class="btn btn-primary">Add Gym</button>
        </form>

        <script>
            // JavaScript code for adding gyms can be implemented here.
        </script>

    {% elif user.user_type == 'customer' %}
        <h2>Available Gyms</h2>
        <div id="gym-list" class="mb-3"></div>
        
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const gymListContainer = document.getElementById('gym-list');
                gymListContainer.innerHTML = '<p>Loading gyms...</p>'; // Loading indicator

                fetch('/api/gymlist/')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        gymListContainer.innerHTML = ''; // Clear loading message
                        if (data.length === 0) {
                            gymListContainer.innerHTML = '<p>No gyms available.</p>';
                        } else {
                            data.forEach(gym => {
                                const gymItem = document.createElement('div');
                                gymItem.classList.add('gym-item');
                                gymItem.innerHTML = `<strong>${gym.name}</strong><p>${gym.description}</p><p>City: ${gym.city}</p>`;
                                gymListContainer.appendChild(gymItem);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching gym list:', error);
                        gymListContainer.innerHTML = '<p>Error loading gyms. Please try again later.</p>';
                    });
            });
        </script>

    {% endif %}
</div>
{% endblock %}
